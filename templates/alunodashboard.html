{% extends "base.html" %}
{% load static %}

{% block title %}Dashboard do Aluno{% endblock %}

{% block content %}
<div class="container mt-4">

  <h1 class="mb-1">
    Bem-vindo, {{ usuario.get_full_name|default:usuario.username }}!
  </h1>
  <h2 class="h4 text-muted mb-4">Área do Aluno</h2>

  {# SEÇÃO: Inscrições recentes do aluno #}
  <section class="status-aluno mb-5">
    <h3 class="h5 mb-3">Suas inscrições recentes</h3>

    {% if inscricoes %}
      <div class="table-responsive">
        <table class="table table-striped table-bordered align-middle">
          <thead class="thead-light">
            <tr>
              <th>Vaga</th>
              <th>Professor</th>
              <th>Data da inscrição</th>
              <th>Status</th>
            </tr>
          </thead>
          <tbody>
          {% for inscricao in inscricoes %}
            <tr>
              <td>{{ inscricao.vaga.titulo }}</td>
              <td>
                {{ inscricao.vaga.professor.get_full_name|default:inscricao.vaga.professor.username }}
              </td>
              <td>{{ inscricao.data_inscricao|date:"d/m/Y H:i" }}</td>
              <td>{{ inscricao.status_inscricao }}</td>
            </tr>
          {% endfor %}
          </tbody>
        </table>
      </div>
    {% else %}
      <p class="text-muted mb-0">
        Você ainda não se inscreveu em nenhuma vaga.
      </p>
    {% endif %}
  </section>

  {# SEÇÃO: Vagas criadas pelos professores e abertas para o aluno se inscrever #}
  <section class="vagas-abertas">
    <h3 class="h5 mb-3">Vagas abertas criadas pelos professores</h3>

    {% if vagas_abertas %}
      <div class="table-responsive">
        <table class="table table-hover align-middle">
          <thead class="thead-light">
            <tr>
              <th>Vaga</th>
              <th>Professor</th>
              <th class="text-right">Ações</th>
            </tr>
          </thead>
          <tbody>
          {% for vaga in vagas_abertas %}
            <tr>
              <td>
                <strong>{{ vaga.titulo }}</strong>
              </td>
              <td>
                {{ vaga.professor.get_full_name|default:vaga.professor.username }}
              </td>
              <td class="text-right">
                <a href="{% url 'candidatar_vaga' vaga.pk %}"
                   class="btn btn-sm btn-primary">
                  Candidatar
                </a>
              </td>
            </tr>
          {% endfor %}
          </tbody>
        </table>
      </div>
    {% else %}
      <p class="text-muted mb-0">
        Não há vagas abertas criadas pelos professores no momento.
      </p>
    {% endif %}
  </section>

</div>
{% endblock %}