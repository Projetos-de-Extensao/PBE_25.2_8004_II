{% extends "base.html" %}
{% load static %}

{% block title %}Home - PBE{% endblock %}

{% block content %}
<div class="container py-5">
  <div class="row justify-content-center">
    <div class="col-md-8 col-lg-6 text-center">
      <h1 class="mb-4 fw-bold" style="font-size:2.5rem;">Bem-vindo ao PBE</h1>
      {% if usuario %}
        <div class="alert alert-success mb-4">Ol√°, {{ usuario.username }}!</div>
      {% else %}
        <a href="{% url 'login' %}" class="btn btn-primary mb-4">Entrar</a>
      {% endif %}
      <div class="card shadow-sm">
        <div class="card-body">
          <h2 class="h5 mb-3">Vagas abertas</h2>
          <section id="vagas">
            <div class="spinner-border text-primary" role="status"><span class="visually-hidden">Carregando...</span></div>
          </section>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Bootstrap CDN -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

<script>
fetch('/api/vagas/')
  .then(r => r.json())
  .then(data => {
    const el = document.getElementById('vagas');
    if (!Array.isArray(data) || data.length === 0) {
      el.innerHTML = '<div class="alert alert-warning">Nenhuma vaga aberta.</div>';
      return;
    }
    el.innerHTML = '<ul class="list-group">' + data.map(v => `<li class="list-group-item">${v.titulo || v.nome}</li>`).join('') + '</ul>';
  })
  .catch(err => {
    console.error(err);
    document.getElementById('vagas').innerHTML = '<div class="alert alert-danger">Erro ao carregar vagas.</div>';
  });
</script>
{% endblock %}